version: '3'

services:
  master1:
    build: .
    hostname: master1
    container_name: master1
    ports:
      - "9871:9870"
      - "8021:8020"
      - "2181:2181"
      - "2888:2888"
      - "3888:3888"
      - "8088:8088"
    volumes:
      - master1-journalnode:/home/hadoop/hadoopdata/hdfs/journalnode
      - master1-namenode:/home/hadoop/hadoopdata/hdfs/namenode
      - master1-zookeeper:/home/hadoop/zookeeper/data
      - ./config/entrypoint.sh:/home/hadoop/entrypoint.sh
    environment:
      - MYID=1
      - ROLE=master
    #entrypoint: ["sudo", "/bin/bash", "/home/hadoop/entrypoint.sh"]

  master2:
    build: .
    hostname: master2
    container_name: master2
    ports:
      - "9872:9870"
      - "8022:8020"
      - "2182:2181"
      - "2889:2888"
      - "3889:3888"
      - "8089:8088"
    volumes:
      - master2-journalnode:/home/hadoop/hadoopdata/hdfs/journalnode
      - master2-namenode:/home/hadoop/hadoopdata/hdfs/namenode
      - master2-zookeeper:/home/hadoop/zookeeper/data
      - ./config/entrypoint.sh:/home/hadoop/entrypoint.sh
    environment:
      - MYID=2
      - ROLE=master
    #entrypoint: ["sudo", "/bin/bash", "/home/hadoop/entrypoint.sh"]

  master3:
    build: .
    hostname: master3
    container_name: master3
    ports:
      - "9873:9870"
      - "8023:8020"
      - "2183:2181"
      - "2890:2888"
      - "3890:3888"
      - "8090:8088"
    volumes:
      - master3-journalnode:/home/hadoop/hadoopdata/hdfs/journalnode
      - master3-namenode:/home/hadoop/hadoopdata/hdfs/namenode
      - master3-zookeeper:/home/hadoop/zookeeper/data
      - ./config/entrypoint.sh:/home/hadoop/entrypoint.sh
    environment:
      - MYID=3
      - ROLE=master
  worker1:
    build: .
    hostname: worker1
    container_name: worker1
    volumes:
      - worker1-datanode:/home/hadoop/hadoopdata/hdfs/datanode
      - ./config/entrypoint.sh:/home/hadoop/entrypoint.sh
    environment:
      - ROLE=worker
volumes:
  master1-journalnode:
  master1-namenode:
  master1-zookeeper:
  master2-journalnode:
  master2-namenode:
  master2-zookeeper:
  master3-journalnode:
  master3-namenode:
  master3-zookeeper:
  worker1-datanode: